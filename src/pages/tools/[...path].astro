---
import { getToolRoutes } from '@/registry/tools'
import { translateMeta } from '@/i18n/utils'
import type { SupportedLanguage } from '@/i18n/utils'
import ToolLayout from '@/layouts/ToolLayout.astro'
import type { ToolRoute } from '@/types/tool'

// Import tool components directly
import RomanConverterIndex from '@/tools/misc/roman-numeral-converter/index.astro'

const componentMap: Record<string, any> = {
  'roman-numeral-converter': RomanConverterIndex,
}

export async function getStaticPaths() {
  const routes = await getToolRoutes()

  return routes.flatMap(route => {
    // Main route
    const paths: Array<{ params: { path: string }; props: { route: ToolRoute; lang: SupportedLanguage; subPath: string | undefined } }> = [{
      params: { path: route.id },
      props: { route, lang: 'en' as const, subPath: undefined }
    }]

    // Sub-routes (if tool defines subPaths)
    if (route.tool.subPaths) {
      route.tool.subPaths.forEach(sub => {
        paths.push({
          params: { path: `${route.id}/${sub}` },
          props: { route, lang: 'en' as const, subPath: sub as string }
        })
      })
    }

    return paths
  })
}

const { route, lang, subPath } = Astro.props as { route: ToolRoute; lang: SupportedLanguage; subPath: string | undefined }
const metadata = translateMeta(route.tool, lang)

// Get component from map
const Component = componentMap[route.id]
---

<ToolLayout title={metadata.name} description={metadata.description} lang={lang}>
  {Component ? (
    <Component ui={metadata.ui} />
  ) : (
    <div class="tool-placeholder">
      <h2>Tool: {route.id}</h2>
      <p>This tool is not yet implemented.</p>
    </div>
  )}
</ToolLayout>

<style>
  .tool-placeholder {
    padding: 2rem;
    background: #f5f5f5;
    border-radius: 8px;
    text-align: center;
  }
</style>
