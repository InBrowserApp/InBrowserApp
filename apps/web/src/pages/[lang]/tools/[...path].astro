---
import { getToolRoutes } from '@inbrowserapp/tools/registry'
import { translateMeta, supportedLanguages } from '@inbrowserapp/tools/i18n'
import type { SupportedLanguage } from '@inbrowserapp/tools/i18n/languages'
import type { ToolRoute } from '@inbrowserapp/tools/types'
import ToolLayout from '@/layouts/ToolLayout.astro'
import { getToolComponent } from '@/registry/components'

export async function getStaticPaths() {
  const routes = await getToolRoutes()
  // Exclude English (English uses default route)
  const languages = supportedLanguages.filter((lang) => lang !== 'en')

  return routes.flatMap((route) =>
    languages.flatMap((lang) => {
      // Main route
      const paths: Array<{
        params: { lang: string; path: string }
        props: { route: ToolRoute; lang: SupportedLanguage; subPath: string | undefined }
      }> = [
        {
          params: { lang, path: route.id },
          props: { route, lang, subPath: undefined },
        },
      ]

      // Sub-routes
      if (route.tool.subPaths) {
        route.tool.subPaths.forEach((sub) => {
          paths.push({
            params: { lang, path: `${route.id}/${sub}` },
            props: { route, lang, subPath: sub as string },
          })
        })
      }

      return paths
    })
  )
}

const { route, lang } = Astro.props as {
  route: ToolRoute
  lang: SupportedLanguage
  subPath: string | undefined
}
const metadata = translateMeta(route.tool, lang)
const Component = getToolComponent(route.id)
---

<ToolLayout title={metadata.name} description={metadata.description} lang={lang}>
  {
    Component ? (
      <Component name={metadata.name} description={metadata.description} ui={metadata.ui} />
    ) : (
      <div class="tool-placeholder">
        <h2>Tool: {route.id}</h2>
        <p>This tool is not yet implemented.</p>
      </div>
    )
  }
</ToolLayout>

<style>
  .tool-placeholder {
    padding: 2rem;
    background: #f5f5f5;
    border-radius: 8px;
    text-align: center;
  }
</style>
