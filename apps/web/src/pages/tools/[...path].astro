---
import { getToolRoutes, getToolComponent } from '@inbrowserapp/tools/registry'
import { translateMeta } from '@inbrowserapp/tools/i18n'
import type { SupportedLanguage } from '@inbrowserapp/tools/i18n/languages'
import type { ToolRoute } from '@inbrowserapp/tools/types'
import ToolLayout from '../../layouts/ToolLayout.astro'

export async function getStaticPaths() {
  const routes = await getToolRoutes()

  return routes.flatMap((route) => {
    // Main route
    const paths: Array<{
      params: { path: string }
      props: { route: ToolRoute; lang: SupportedLanguage; subPath: string | undefined }
    }> = [
      {
        params: { path: route.id },
        props: { route, lang: 'en' as const, subPath: undefined },
      },
    ]

    // Sub-routes (if tool defines subPaths)
    if (route.tool.subPaths) {
      route.tool.subPaths.forEach((sub) => {
        paths.push({
          params: { path: `${route.id}/${sub}` },
          props: { route, lang: 'en' as const, subPath: sub as string },
        })
      })
    }

    return paths
  })
}

const { route, lang } = Astro.props as {
  route: ToolRoute
  lang: SupportedLanguage
  subPath: string | undefined
}
const metadata = translateMeta(route.tool, lang)
const Component = getToolComponent(route.id)
---

<ToolLayout title={metadata.name} description={metadata.description} lang={lang}>
  {
    Component ? (
      <Component name={metadata.name} description={metadata.description} ui={metadata.ui} />
    ) : (
      <div class="p-8 bg-gray-100 dark:bg-gray-800 rounded-lg text-center">
        <h2 class="text-xl font-semibold mb-2">Tool: {route.id}</h2>
        <p class="text-gray-600 dark:text-gray-400">This tool is not yet implemented.</p>
      </div>
    )
  }
</ToolLayout>
